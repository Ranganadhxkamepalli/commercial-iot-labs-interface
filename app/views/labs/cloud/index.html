<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-10">
    <h4>Data Analytics in the Cloud</h4>
    <ol class="breadcrumb">
      <li>
        <a href="index.html">Home</a>
      </li>
      <li>
        <a>Labs</a>
      </li>
      <li class="active">
        <strong>Data Analytics in the Cloud</strong>
      </li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight" ng-controller="CodeEditorCtrl">
  <div class="row">
    <div class="col-lg-12">

      <!-- Objectives -->
      <div ibox collapse title="Objectives">
        <div content-block name="cloud-objectives" message="Read the Objectives">
          <p>Send data to a private cloud services and visualize the result</p>
        </div>
      </div>

      <!-- Exercise 1: Introduction to Cloud Services -->
      <div ibox collapse title="Exercise 1: Introduction to Cloud Services">
        <div content-block name="private-cloud" message="Read about the Message Format needed to send data to the private cloud" image-link="./views/labs/cloud/part1/image1.png">
          <p>Private cloud service is provided for data collection and visualization.</p>

          <p>There is the private IoT Cloud service provided with MQTT connectivity and broker as part of the IoT Cloud offering. The IP address of cloud is <b>198.211.103.31</b>. You can access the service by clicking on following link <a href="http://198.211.103.31:8080"
              target="_blank">http://198.211.103.31:8080</a>
          </p>

          <p>This cloud service needs specific topic structure as well as message format to visualize or analyse data. </p>

          <p><b>MQTT Topic to send date</b></p>
          <p><code>gateways/<b>{Gateway Id}</b>/sensors/<b>{Sensor Id}</b>/data </code> </p>
          <p>Here Gateway Id and Sensor Id is user dependant. For standarized represenatation of all IoT devices please use Gateway Id as last 4 digit of your wireless Mac address.</p>

          <p><b>MQTT Message Format</b></p>
          <pre><code>{
            "gateway_id":"E2D0",
            "sensor_id":"light",
            "value":90,
            "timestamp":1457303819281
          }</code> </pre>
          <p>This is a standarized representation of message format which is accepted by cloud service.</p>
        </div>
      </div>

      <!-- Exercise 2: Node-RED Application on Gateway -->
      <div ibox  title="Exercise 2: Node-RED Application on Gateway">
        <div content-block message="Read the Objectives"
            name="cloud-objective-node-red">
          <p>Create a node-red application to collect data from sensors, take average of 5 consecutive data and send to cloud service.</p>
        </div>
        <div content-block message="Install and Run Node-RED on Gateway"
             name="install-node-red-on-gateway" >
          <h4>Install and Run Node-RED on Gateway </h4>
          <p>If you have already installed Node-RED on your gateway then you can skip installation step and directly run node-red.</p>
          <p>SSH into your gateway. For more information on steps to Login gateway you can check Step 3 of Module 1 </p>

          <p>Install Node-RED with,
            <code>$ npm install -g node-red</code>
          </p>
          <p> You should now run the Node-RED server by typing,
            <code>$ node-red</code> </p>
            <p> To access Node-RED in your browser, click on <a href="http://192.168.1.1:1880" target="_blank">http://192.168.1.1:1880</a>
            </p>
        </div>
        <div content-block message="Create following flow using a MQTT node and a function node"
             name="create-node-red-appliction-on-gateway" image-link="./views/labs/cloud/part2/image1.png">
          <h4>Create Node-RED application on gateway</h4>
          <ol>
            <li>
              <p>Create following flow using mqtt (input), debug, function and mqtt (output).</p>
            </li>
          </ol>
        </div>
        <div content-block message="Configure the Node-Red Nodes"
           name="configure-node-red-nodes" image-link="./views/labs/cloud/part2/image2.png">
          <ol>
            <li>
              <p>Configure mqtt(input) node. Add new Server with server as "localhost" and port number as 1883. (Port 1883 is default assigned MQTT port.) Add topic for mqtt where sensors are publishing data. In this example we have assumed that sensors
                are publishing data on topic <code>sensors/<b>{Sensor Id}</b>/data</code> (i.e sensors/temperature/data where temperature is Sensor Id.)
              </p>
            </li>
          </ol>
        </div>
        <div content-block message="Write the averaging function"
             name="cloud-write-function" image-link="./views/labs/cloud/part2/image3.png">
        <ol>
          <li>
            <p>Configure Function node in a way that collects the data for 5 consecutive values, find an average out of it and send that reduced average data to cloud. You can also look into following given code.
              <strong>Change gatewayId on 2nd line of following code with last 4 digit of your Gaterway Wireless Mac Address.</strong> (i.e Change 1234 to new 4 digit wireless mac address)
            </p>

            <ui-codemirror ui-codemirror-opts="editorOptions" id="example1"></ui-codemirror>
          </li>
        </ol>
      </div>


      <div content-block message="Configure MQTT to send data to the private cloud"
      name="cloud-configure-mqtt" image-link="./views/labs/cloud/part2/image4.png">
        <ol>
          <li>
            <p>Configure Mqtt(output) to send data to cloud. Add new Server with server as "198.211.103.31" and port number as 1883. This is server address of our IoT cloud. Leave topic,qos and retain blank because we have already setup all these properties via message properties. That node will look like below image.</p>
          </li>
          <li>
            The Debug node causes any message to be displayed in the Debug sidebar. By default, it just displays the payload of the message, but it is possible to display the entire message object.
          </li>
        </ol>
      </div>


      <div content-block message="Deploy the Node-Red flow"
           name="cloud-deploy-the-flow" image-link="./views/labs/cloud/part2/image5.png">
        <ol>
          <li>
            <p>The final flow of our configuration will look like below shown image. Names of nodes might differ from what you have assigned.</p>
          </li>

          <li>
            <p>Click the Deploy button to deploy this flow to your gateway. The button to the right of the node will toggle its output on and off so you can de-clutter the debug window.</p>
          </li>
        </ol>
      </div>

      <div content-block message="cloud-import" name="If you need the solution, you can import it.">
        <h4> Node-RED Flow Source </h4>
        <p> Any flow in Node-RED can be exported / imported as a JSON object. The code for the above flow is displayed below. To import it into your work space copy the text, hit Ctrl-I in the Node-RED workspace and paste the text in.</p>
        <ui-codemirror ui-codemirror-opts="editorOptions" id="example2"></ui-codemirror>
      </div>
    </div>

    <div ibox collapse title="Exercise 3: Visualize Data in Cloud">
      <div content-block name="cloud-exercise-3" message="Complete Exercise 3: Visualize Data in Cloud">
        <p>
          Visualize and analyze your Data which you are sending from gateway in cloud.
        </p>
      </div>

      <div content-block message="Enter your Gateway Id and click on Plot" name="cloud-enter-your-gateway" image-link="./views/labs/cloud/part3/image1.png">
        <h4>Visualize your Realtime Data via Graph and Table </h4>
        <p>Go to cloud service provided at <a href="http://198.211.103.31:8080" target="_blank">http://198.211.103.31:8080</a>. Enter your Gateway Id and click on Plot.
        </p>
      </div>
      <div content-block message="Visualize Your Data" name="cloud-graph-plotting" image-link="./views/labs/cloud/part3/image2.png">
        <p>You will see your realtime graph plotting for your specified gateway Id.</p>
      </div>
      <div content-block message="View Your data in table format" name="cloud-data-table" image-link="./views/labs/cloud/part3/image3.png">
        <p>If you scroll down then you can also visualize your data in table format.</p>
      </div>
    </div>

    </div>
  </div>
</div>
